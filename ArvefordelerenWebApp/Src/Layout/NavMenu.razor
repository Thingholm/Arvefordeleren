@rendermode InteractiveServer
@inject IJSRuntime JSRuntime

<Bar Breakpoint="Breakpoint.Desktop">
    <BarBrand>
        <BarLink To="/">
            Arvefordeleren
        </BarLink>
    </BarBrand>
    <BarMenu>
        <BarEnd>
            <BarItem>
                <BarLink To="/stamtræ">
                    Stamtræ
                </BarLink>
            </BarItem>
            <BarItem>
                <BarLink To="/aktiver">
                    Aktiver
                </BarLink>
            </BarItem>
            <BarItem>
                <BarLink To="/arvfordeling">
                    Arvfordeling
                </BarLink>
            </BarItem>
            <BarItem>
                <Button Color="Color.Secondary">Upload</Button>
                <Button  @onclick="DownloadPageAsPdf" Color="Color.Primary">Download</Button>
            </BarItem>
        </BarEnd>
    </BarMenu>
</Bar>

@code {
    private async Task DownloadPageAsPdf()
    {
        var jsonContent = AssetsRepository.GetAssetsAsJson() + InheritorRepository.GetInheritorsAsJson();
        var pdfBytes = PdfService.GeneratePdfFromJson(jsonContent);

        await using var stream = new MemoryStream(pdfBytes);
        var fileName = "Arvefordeleren.pdf";
        await JSRuntime.InvokeVoidAsync("downloadFile", fileName, "application/pdf", Convert.ToBase64String(pdfBytes));
    }
}