@page "/aktiver"
@rendermode InteractiveServer
@inject IJSRuntime JSRuntime

<PageTitle>Aktiver</PageTitle>

<h1>Aktiver</h1>

<Table>
    <TableHeader>
        <TableRow>
            <TableHeaderCell>Aktiv</TableHeaderCell>
            <TableHeaderCell>VÃ¦rdi</TableHeaderCell>
            <TableHeaderCell>Likvid</TableHeaderCell>
            <TableHeaderCell></TableHeaderCell>
        </TableRow>
    </TableHeader>
    <TableBody>
        @foreach (Asset asset in assets)
        {
            <TableRow @key="asset.Id">
                <TableRowCell class="align-middle">@asset.Name</TableRowCell>
                <TableRowCell class="align-middle">@((asset.Value ?? 0).ToString("N2"))</TableRowCell>
                <TableRowCell class="align-middle">@(asset.Liquid ? "x" : "")</TableRowCell>
                <TableRowCell class="col-1 align-middle">
                    <EditAsset @bind-Assets="assets" Asset="asset"/>
                    <Button @onclick="() => DeleteAsset(asset)"><Icon Name="IconName.Delete" style="color: #cf0000"/></Button>
                </TableRowCell>
            </TableRow>
        }
    </TableBody>
</Table>
<button @onclick="DownloadAssetsAsPdf">DOWNLOAD!!!!!</button>

<AddAsset @bind-Assets=assets/>

@code {
    private List<Asset> assets = AssetsRepository.GetAssets();
    
    private void DeleteAsset(Asset asset)
    {
        AssetsRepository.DeleteAsset(asset);
        assets = AssetsRepository.GetAssets();
    }

    private async Task DownloadAssetsAsPdf()
    {
        var jsonContent = AssetsRepository.GetAssetsAsJson();
        var pdfBytes = PdfService.GeneratePdfFromJson(jsonContent);

        await using var stream = new MemoryStream(pdfBytes);
        var fileName = "Assets.pdf";
        await JSRuntime.InvokeVoidAsync("downloadFile", fileName, "application/pdf", Convert.ToBase64String(pdfBytes));
    }
}